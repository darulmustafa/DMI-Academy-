<!doctype html>
<html lang="bn" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶∞‡ßç‡¶•‡ßÄ ‡¶´‡¶ø ‡¶∏‡¶Ç‡¶ó‡ßç‡¶∞‡¶π | Student Fees Collection</title>
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&amp;family=Poppins:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-green: #0d6e3f;
      --secondary-gold: #c9a227;
      --dark-text: #1a1a2e;
      --light-bg: #f8f9fa;
      --card-bg: #ffffff;
    }
    
    * {
      font-family: 'Hind Siliguri', 'Poppins', sans-serif;
    }
    
    .font-bengali {
      font-family: 'Hind Siliguri', sans-serif;
    }
    
    .font-english {
      font-family: 'Poppins', sans-serif;
    }
    
    html, body {
      height: 100%;
    }
    
    body {
      background: linear-gradient(135deg, #f0fdf4 0%, #fef3c7 100%);
    }
    
    .search-container {
      background: linear-gradient(135deg, rgba(13, 110, 63, 0.95) 0%, rgba(201, 162, 39, 0.95) 100%);
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(13, 110, 63, 0.2);
    }
    
    .search-input {
      transition: all 0.3s ease;
      border: 2px solid rgba(255, 255, 255, 0.3);
      background: rgba(255, 255, 255, 0.95);
    }
    
    .search-input:focus {
      border-color: white;
      box-shadow: 0 0 20px rgba(201, 162, 39, 0.5);
      outline: none;
    }
    
    .fees-card {
      background: linear-gradient(135deg, #ffffff 0%, #f8fdf9 100%);
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
      border-radius: 12px;
      overflow: hidden;
      animation: slideUp 0.5s ease;
    }
    
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .header-section {
      background: linear-gradient(135deg, #0d6e3f 0%, #1a8f5c 50%, #c9a227 100%);
      padding: 24px;
      color: white;
      position: relative;
      overflow: hidden;
    }
    
    .header-section::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 300px;
      height: 300px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 50%;
    }
    
    .student-info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 20px;
    }
    
    .info-card {
      background: #f8f9fa;
      padding: 12px 16px;
      border-radius: 8px;
      border-left: 4px solid var(--primary-green);
    }
    
    .info-label {
      font-size: 0.75rem;
      font-weight: 600;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .info-value {
      font-size: 1rem;
      font-weight: 600;
      color: var(--dark-text);
      margin-top: 4px;
    }
    
    .fees-table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }
    
    .fees-table thead {
      background: linear-gradient(135deg, #0d6e3f 0%, #1a8f5c 100%);
      color: white;
    }
    
    .fees-table th {
      padding: 12px 16px;
      text-align: left;
      font-weight: 600;
      font-size: 0.9rem;
      border: none;
    }
    
    .fees-table td {
      padding: 12px 16px;
      border-bottom: 1px solid #e5e7eb;
      font-size: 0.95rem;
    }
    
    .fees-table tbody tr:hover {
      background-color: #f9fafb;
    }
    
    .fees-table tr:last-child td {
      border-bottom: 2px solid #c9a227;
    }
    
    .input-field {
      width: 100%;
      padding: 8px 12px;
      border: 2px solid #e5e7eb;
      border-radius: 6px;
      font-size: 0.95rem;
      transition: all 0.3s ease;
      font-family: 'Poppins', sans-serif;
      font-weight: 600;
    }
    
    .input-field:focus {
      border-color: var(--primary-green);
      box-shadow: 0 0 8px rgba(13, 110, 63, 0.2);
      outline: none;
    }
    
    .summary-section {
      background: linear-gradient(135deg, #f0fdf4 0%, #fef3c7 100%);
      padding: 20px;
      border-radius: 8px;
      margin-top: 20px;
      border: 2px solid var(--primary-green);
    }
    
    .summary-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      font-size: 1rem;
      font-weight: 600;
    }
    
    .summary-row:not(:last-child) {
      border-bottom: 1px dashed #d1d5db;
    }
    
    .summary-label {
      color: var(--dark-text);
    }
    
    .summary-value {
      color: var(--primary-green);
      font-size: 1.1rem;
    }
    
    .summary-row.total .summary-value {
      color: white;
      background: var(--primary-green);
      padding: 8px 16px;
      border-radius: 6px;
    }
    
    .loading-spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid var(--primary-green);
      border-radius: 50%;
      width: 32px;
      height: 32px;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .toast {
      animation: slideIn 0.3s ease;
    }
    
    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    .btn-group {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 24px;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, var(--primary-green) 0%, #1a8f5c 100%);
      color: white;
      padding: 12px 24px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 1rem;
    }
    
    .btn-primary:hover:not(:disabled) {
      box-shadow: 0 8px 16px rgba(13, 110, 63, 0.3);
      transform: translateY(-2px);
    }
    
    .btn-secondary {
      background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
      color: white;
      padding: 12px 24px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 1rem;
    }
    
    .btn-secondary:hover:not(:disabled) {
      box-shadow: 0 8px 16px rgba(75, 85, 99, 0.3);
      transform: translateY(-2px);
    }
    
    .btn-primary:disabled, .btn-secondary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #6b7280;
    }
    
    .empty-state-icon {
      font-size: 64px;
      margin-bottom: 16px;
      opacity: 0.5;
    }
    
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    
    .modal-overlay.active {
      display: flex;
    }
    
    .modal-content {
      background: white;
      border-radius: 12px;
      padding: 24px;
      max-width: 500px;
      width: 90%;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }
    
    .modal-header {
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--dark-text);
      margin-bottom: 16px;
    }
    
    .modal-body {
      color: #6b7280;
      margin-bottom: 24px;
      line-height: 1.6;
    }
    
    .modal-summary {
      background: #f9fafb;
      padding: 12px 16px;
      border-radius: 8px;
      margin-bottom: 16px;
      border-left: 4px solid var(--primary-green);
    }
    
    .modal-summary-row {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      font-weight: 600;
    }
    
    .modal-actions {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
    }
    
    .btn-cancel {
      background: #e5e7eb;
      color: var(--dark-text);
      padding: 10px 20px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    
    .btn-cancel:hover {
      background: #d1d5db;
    }
    
    .btn-confirm {
      background: linear-gradient(135deg, var(--primary-green) 0%, #1a8f5c 100%);
      color: white;
      padding: 10px 20px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    
    .btn-confirm:hover:not(:disabled) {
      box-shadow: 0 4px 12px rgba(13, 110, 63, 0.3);
      transform: translateY(-1px);
    }
    
    .btn-confirm:disabled, .btn-cancel:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .no-data-message {
      text-align: center;
      padding: 40px 20px;
      color: #9ca3af;
    }
  </style>
  <style>body { box-sizing: border-box; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full overflow-auto">
  <div id="app" class="h-full flex flex-col"><!-- Toast Container -->
   <div id="toast-container" class="fixed top-4 right-4 z-50 max-w-sm"></div><!-- Header & Search -->
   <div class="search-container sticky top-0 z-40">
    <div class="max-w-6xl mx-auto p-4 md:p-6"><!-- Institution Header -->
     <div class="mb-6 text-white">
      <div class="flex items-center gap-3 mb-3">
       <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center shadow-lg">
        <svg viewbox="0 0 100 100" class="w-14 h-14">
  <circle cx="50" cy="50" r="45" fill="#0d6e3f" stroke="#c9a227" stroke-width="3" /> 
  
  <path d="M50 5 L50 15 M50 85 L50 95 M5 50 L15 50 M85 50 L95 50" stroke="#c9a227" stroke-width="2" /> 
  
  <circle cx="50" cy="50" r="35" fill="#ffffff" stroke="#c9a227" stroke-width="2" /> 

  <defs>
    <clipPath id="circleView">
      <circle cx="50" cy="50" r="34" />
    </clipPath>
  </defs>
  
  <image 
    xlink:href="logo.jpg" 
    x="15" y="15" 
    height="70" width="70" 
    clip-path="url(#circleView)"
    preserveAspectRatio="xMidYMid slice"
  />
</svg>
       </div>
       <div class="flex-1">
        <h1 class="text-xl md:text-2xl font-bold font-bengali" id="header-institution-bn">‡¶¶‡¶æ‡¶∞‡ßÅ‡¶≤ ‡¶Æ‡ßã‡¶∏‡ßç‡¶§‡¶´‡¶æ ‡¶∏‡¶æ‡¶É ‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡ßÄ ‡¶è‡¶ï‡¶æ‡¶°‡ßá‡¶Æ‡¶ø</h1>
        <p class="text-emerald-100 text-sm font-english" id="header-institution-en">Darul Mustafa (SAW) Islamic Academy</p>
        <p class="text-emerald-200 text-xs mt-1 font-bengali" id="header-address">‡¶™‡¶æ‡¶•‡¶∞ ‡¶™‡¶æ‡¶°‡¶º‡¶æ, ‡¶¨‡¶æ‡¶á‡¶§‡ßÅ‡¶≤ ‡¶Æ‡¶æ‡¶Æ‡ßÅ‡¶∞ ‡¶ú‡¶æ‡¶Æ‡ßá ‡¶Æ‡¶∏‡¶ú‡¶ø‡¶¶ ‡¶∏‡¶Ç‡¶≤‡¶ó‡ßç‡¶®, ‡¶Æ‡¶õ‡¶ú‡¶ø‡¶¶‡ßç‡¶¶‡¶æ, ‡¶∏‡ßÄ‡¶§‡¶æ‡¶ï‡ßÅ‡¶£‡ßç‡¶°, ‡¶ö‡¶ü‡ßç‡¶ü‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ</p>
       </div>
      </div>
     </div><!-- Page Title -->
     <h2 class="text-white text-lg md:text-xl font-bold font-bengali mb-4" id="page-title">‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶∞‡ßç‡¶•‡ßÄ ‡¶´‡¶ø ‡¶∏‡¶Ç‡¶ó‡ßç‡¶∞‡¶π | Student Fees Collection</h2><!-- Search Bar -->
     <div class="bg-white/10 backdrop-blur-md rounded-xl p-4"><label class="block text-white text-sm font-bold mb-3 font-bengali">‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶∞‡ßç‡¶•‡ßÄ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶Ö‡¶®‡ßÅ‡¶∏‡¶®‡ßç‡¶ß‡¶æ‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® | Search by Student ID</label>
      <div class="flex gap-2 flex-wrap"><input type="text" id="search-id" class="search-input flex-1 min-w-[200px] px-4 py-3 rounded-lg font-english text-lg" placeholder="Enter Student ID (e.g., STU001, 001)" onkeypress="if(event.key==='Enter') searchStudent()"> <button onclick="searchStudent()" class="btn-primary">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg><span class="font-bengali">‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®</span> </button> <button onclick="resetSearch()" class="btn-secondary">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
        </svg><span class="font-bengali">‡¶®‡¶§‡ßÅ‡¶®</span> </button>
      </div>
     </div>
    </div>
   </div><!-- Main Content -->
   <div class="flex-1 overflow-auto p-4 md:p-6">
    <div class="max-w-6xl mx-auto"><!-- Empty State -->
     <div id="empty-state" class="empty-state">
      <div class="empty-state-icon">
       üí∞
      </div>
      <h2 class="text-2xl font-bold text-gray-700 mb-2 font-bengali">‡¶´‡¶ø ‡¶∏‡¶Ç‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
      <p class="text-gray-600 font-english">Collect Student Fees</p>
      <p class="text-gray-500 text-sm mt-4 font-bengali">‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶∞‡ßç‡¶•‡ßÄ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶ñ‡ßã‡¶Å‡¶ú ‡¶ï‡¶∞‡¶§‡ßá ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®</p>
     </div><!-- Loading State -->
     <div id="loading-state" class="hidden text-center py-12">
      <div class="flex justify-center mb-4">
       <div class="loading-spinner"></div>
      </div>
      <p class="text-gray-600 font-bengali">‡¶§‡¶•‡ßç‡¶Ø ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
      <p class="text-gray-500 text-sm font-english">Loading student data...</p>
     </div><!-- Fees Form -->
     <div id="fees-container" class="hidden">
      <div class="fees-card"><!-- Header Section -->
       <div class="header-section">
        <div class="relative z-10">
         <h2 class="text-lg font-bold font-bengali mb-4">‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶∞‡ßç‡¶•‡ßÄ ‡¶§‡¶•‡ßç‡¶Ø | Student Information</h2>
         <div class="student-info-grid">
          <div class="info-card">
           <p class="info-label font-bengali">‡¶Ü‡¶á‡¶°‡¶ø | ID</p>
           <p class="info-value" id="info-student-id">-</p>
          </div>
          <div class="info-card">
           <p class="info-label font-bengali">‡¶®‡¶æ‡¶Æ | Name</p>
           <p class="info-value" id="info-student-name">-</p>
          </div>
          <div class="info-card">
           <p class="info-label font-bengali">‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ | Class</p>
           <p class="info-value" id="info-student-class">-</p>
          </div>
         </div>
        </div>
       </div><!-- Fees Table -->
       <div class="p-6">
        <h3 class="text-base font-bold text-white bg-gradient-to-r from-emerald-700 to-emerald-600 px-4 py-2 rounded mb-4 font-bengali">‡¶´‡¶ø ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ | Fee List</h3>
        <div class="overflow-x-auto">
         <table class="fees-table">
          <thead>
           <tr>
            <th class="font-bengali">‡¶ï‡ßç‡¶∞.</th>
            <th class="font-bengali">‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ ‡¶®‡¶æ‡¶Æ</th>
            <th class="font-bengali text-right">‡¶Æ‡ßã‡¶ü ‡¶ü‡¶æ‡¶ï‡¶æ</th>
            <th class="font-bengali text-right">‡¶Ü‡¶¶‡¶æ‡¶Ø‡¶º‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</th>
            <th class="font-bengali text-right">‡¶õ‡¶æ‡¶°‡¶º</th>
           </tr>
          </thead>
          <tbody id="fees-table-body"><!-- Dynamically populated -->
          </tbody>
         </table>
        </div>
        <div id="no-fees-message" class="no-data-message hidden">
         <p class="font-bengali">‡¶ï‡ßã‡¶®‡ßã ‡¶´‡¶ø ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶™‡¶∞‡¶∂‡ßÅ‡¶∞‡¶æ‡¶Æ ‡¶¨‡¶æ ‡¶∏‡ßá‡¶¨‡¶æ ‡¶™‡ßç‡¶∞‡¶¶‡¶æ‡¶®‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
        </div><!-- Summary Section -->
        <div class="summary-section">
         <div class="summary-row"><span class="summary-label font-bengali">‡¶Æ‡ßã‡¶ü ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø</span> <span class="summary-value font-english" id="total-payable">‡ß≥ 0</span>
         </div>
         <div class="summary-row"><span class="summary-label font-bengali">‡¶Æ‡ßã‡¶ü ‡¶Ü‡¶¶‡¶æ‡¶Ø‡¶º‡¶ï‡ßÉ‡¶§</span> <span class="summary-value font-english" id="total-received">‡ß≥ 0</span>
         </div>
         <div class="summary-row"><span class="summary-label font-bengali">‡¶Æ‡ßã‡¶ü ‡¶õ‡¶æ‡¶°‡¶º</span> <span class="summary-value font-english" id="total-discount">‡ß≥ 0</span>
         </div>
         <div class="summary-row total"><span class="summary-label font-bengali">‡¶®‡ßá‡¶ü ‡¶™‡¶∞‡¶ø‡¶∂‡ßã‡¶ß‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø</span> <span class="summary-value font-english" id="net-payable">‡ß≥ 0</span>
         </div>
        </div><!-- Action Buttons -->
        <div class="btn-group"><button onclick="submitFees()" class="btn-primary">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
          </svg><span class="font-bengali">‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®</span> </button> <button onclick="resetSearch()" class="btn-secondary">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg><span class="font-bengali">‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡¶®‡ßÅ‡¶∏‡¶®‡ßç‡¶ß‡¶æ‡¶®</span> </button>
        </div>
       </div>
      </div>
     </div><!-- Error State -->
     <div id="error-state" class="hidden text-center py-12 px-4">
      <div class="text-6xl mb-4">
       ‚ùå
      </div>
      <h2 class="text-2xl font-bold text-gray-700 mb-2 font-bengali">‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶∞‡ßç‡¶•‡ßÄ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø</h2>
      <p class="text-gray-600 font-english mb-4">Student not found</p>
      <p class="text-gray-500 text-sm font-bengali" id="error-message">‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶∞‡ßç‡¶•‡ßÄ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p><button onclick="resetSearch()" class="btn-primary mt-6 mx-auto"> <span class="font-bengali">‡¶™‡ßÅ‡¶®‡¶∞‡¶æ‡¶Ø‡¶º ‡¶ñ‡ßã‡¶Å‡¶ú ‡¶ï‡¶∞‡ßÅ‡¶®</span> </button>
     </div>
    </div>
   </div>
  </div><!-- Confirmation Modal -->
  <div id="confirmation-modal" class="modal-overlay">
   <div class="modal-content">
    <div class="modal-header font-bengali">
     ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶§‡ßá ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®
    </div>
    <div class="modal-body font-bengali">
     ‡¶Ü‡¶™‡¶®‡¶ø ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶§‡ßá ‡¶ö‡¶≤‡ßá‡¶õ‡ßá‡¶®‡•§ ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®‡•§
    </div>
    <div class="modal-summary">
     <div class="modal-summary-row font-bengali"><span>‡¶Æ‡ßã‡¶ü ‡¶Ü‡¶¶‡¶æ‡¶Ø‡¶º‡¶ï‡ßÉ‡¶§:</span> <span id="confirm-total-received" class="font-english font-bold">‡ß≥ 0</span>
     </div>
     <div class="modal-summary-row font-bengali"><span>‡¶Æ‡ßã‡¶ü ‡¶õ‡¶æ‡¶°‡¶º:</span> <span id="confirm-total-discount" class="font-english font-bold">‡ß≥ 0</span>
     </div>
    </div>
    <div class="modal-actions"><button onclick="closeConfirmationModal()" class="btn-cancel font-bengali">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®</button> <button onclick="confirmSubmit()" id="confirm-submit-btn" class="btn-confirm font-bengali">‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®</button>
    </div>
   </div>
  </div>
<script>
  // ==============================
  // Configuration
  // ==============================
  const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxH2ShfW8utheJXWonFOA32QM2aHYqUWr-7zLo-jNhSID1m3wfLYjhatu4yZVlGxgWRbw/exec';

  const defaultConfig = {
    institution_name_bn: '‡¶¶‡¶æ‡¶∞‡ßÅ‡¶≤ ‡¶Æ‡ßã‡¶∏‡ßç‡¶§‡¶´‡¶æ ‡¶∏‡¶æ‡¶É ‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡ßÄ ‡¶è‡¶ï‡¶æ‡¶°‡ßá‡¶Æ‡¶ø',
    institution_name_en: 'Darul Mustafa (SAW) Islamic Academy',
    institution_address: '‡¶™‡¶æ‡¶•‡¶∞ ‡¶™‡¶æ‡¶°‡¶º‡¶æ, ‡¶¨‡¶æ‡¶á‡¶§‡ßÅ‡¶≤ ‡¶Æ‡¶æ‡¶Æ‡ßÅ‡¶∞ ‡¶ú‡¶æ‡¶Æ‡ßá ‡¶Æ‡¶∏‡¶ú‡¶ø‡¶¶ ‡¶∏‡¶Ç‡¶≤‡¶ó‡ßç‡¶®, ‡¶Æ‡¶õ‡¶ú‡¶ø‡¶¶‡ßç‡¶¶‡¶æ, ‡¶∏‡ßÄ‡¶§‡¶æ‡¶ï‡ßÅ‡¶£‡ßç‡¶°, ‡¶ö‡¶ü‡ßç‡¶ü‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ',
    page_title: '‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶∞‡ßç‡¶•‡ßÄ ‡¶´‡¶ø ‡¶∏‡¶Ç‡¶ó‡ßç‡¶∞‡¶π | Student Fees Collection'
  };

  let currentStudent = null;
  let currentFees = [];
  let feeInputs = {};

  // ==============================
  // Element SDK Handler
  // ==============================
  const elementHandler = {
    defaultConfig,
    async onConfigChange(config) {
      document.getElementById('header-institution-bn').textContent = config.institution_name_bn || defaultConfig.institution_name_bn;
      document.getElementById('header-institution-en').textContent = config.institution_name_en || defaultConfig.institution_name_en;
      document.getElementById('header-address').textContent = config.institution_address || defaultConfig.institution_address;
      document.getElementById('page-title').textContent = config.page_title || defaultConfig.page_title;
    },
    mapToCapabilities(config) {
      return { recolorables: [], borderables: [], fontEditable: undefined, fontSizeable: undefined };
    },
    mapToEditPanelValues(config) {
      return new Map([
        ['institution_name_bn', config.institution_name_bn || defaultConfig.institution_name_bn],
        ['institution_name_en', config.institution_name_en || defaultConfig.institution_name_en],
        ['institution_address', config.institution_address || defaultConfig.institution_address],
        ['page_title', config.page_title || defaultConfig.page_title]
      ]);
    }
  };

  if (window.elementSdk) window.elementSdk.init(elementHandler);

  // Set initial values
  document.getElementById('header-institution-bn').textContent = defaultConfig.institution_name_bn;
  document.getElementById('header-institution-en').textContent = defaultConfig.institution_name_en;
  document.getElementById('header-address').textContent = defaultConfig.institution_address;
  document.getElementById('page-title').textContent = defaultConfig.page_title;

  // ==============================
  // Helper Functions
  // ==============================
  function showToast(message, type = 'info') {
    const container = document.getElementById('toast-container');
    const toast = document.createElement('div');
    const bgClass = type === 'success' ? 'bg-emerald-600' : type === 'error' ? 'bg-red-600' : type === 'warning' ? 'bg-amber-600' : 'bg-blue-600';
    toast.className = `toast ${bgClass} text-white px-6 py-4 rounded-lg shadow-xl mb-3 font-medium font-bengali`;
    toast.textContent = message;
    container.appendChild(toast);
    setTimeout(() => {
      toast.style.animation = 'slideIn 0.3s ease reverse';
      setTimeout(() => toast.remove(), 300);
    }, 4000);
  }

  function formatCurrency(num) {
    return '‡ß≥ ' + (Math.round(num * 100) / 100).toLocaleString('bn-BD');
  }

  function parseBengaliNumber(str) {
    return parseInt(String(str).replace(/[‡ß¶-‡ßØ]/g, d => '‡ß¶123456789'.indexOf(d))) || 0;
  }

  // ==============================
  // Search Student
  // ==============================
  async function searchStudent() {
    const searchInput = document.getElementById('search-id');
    const searchId = searchInput.value.trim();

    if (!searchId) {
      showToast('‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶∞‡ßç‡¶•‡ßÄ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®', 'warning');
      return;
    }

    if (!SCRIPT_URL || SCRIPT_URL.includes('YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE')) {
      showToast('Google Apps Script URL ‡¶è‡¶ñ‡¶®‡ßã ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§', 'error');
      return;
    }

    // Loading state
    document.getElementById('empty-state').classList.add('hidden');
    document.getElementById('error-state').classList.add('hidden');
    document.getElementById('fees-container').classList.add('hidden');
    document.getElementById('loading-state').classList.remove('hidden');

    try {
      const response = await fetch(`${SCRIPT_URL}?action=search&id=${encodeURIComponent(searchId)}`);
      const data = await response.json();

      if (!data.success) {
        document.getElementById('loading-state').classList.add('hidden');
        document.getElementById('error-state').classList.remove('hidden');
        document.getElementById('error-message').textContent = `"${searchId}" ‡¶Ü‡¶á‡¶°‡¶ø ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶∞‡ßç‡¶•‡ßÄ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§`;
        showToast('‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶∞‡ßç‡¶•‡ßÄ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø', 'error');
        return;
      }

      currentStudent = data;
      document.getElementById('info-student-id').textContent = data.form_id || '-';
      document.getElementById('info-student-name').textContent = data.student_name_bn || '-';
      document.getElementById('info-student-class').textContent = data.admitted_class || '-';

      await loadFeesForClass(data.admitted_class, data.form_id);

      document.getElementById('loading-state').classList.add('hidden');
      document.getElementById('fees-container').classList.remove('hidden');
      showToast('‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶∞‡ßç‡¶•‡ßÄ ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'success');

    } catch (error) {
      console.error('Search error:', error);
      document.getElementById('loading-state').classList.add('hidden');
      document.getElementById('error-state').classList.remove('hidden');
      document.getElementById('error-message').textContent = '‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶™‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§';
      showToast('‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø', 'error');
    }
  }

  // ==============================
  // Load Fees
  // ==============================
  async function loadFeesForClass(className, studentId = '') {
    try {
      const response = await fetch(`${SCRIPT_URL}?action=getFees&class=${encodeURIComponent(className)}&id=${encodeURIComponent(studentId)}`);
      const data = await response.json();

      if (data.success && data.fees) {
        currentFees = data.fees;
        populateFeesTable();
      } else {
        document.getElementById('no-fees-message').classList.remove('hidden');
        document.getElementById('fees-table-body').innerHTML = '';
      }
    } catch (error) {
      console.error('Load fees error:', error);
      showToast('‡¶´‡¶ø ‡¶§‡¶•‡ßç‡¶Ø ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•', 'error');
    }
  }

  // ==============================
  // Populate Fees Table
  // ==============================
  function populateFeesTable() {
    const tableBody = document.getElementById('fees-table-body');
    const noFeesMsg = document.getElementById('no-fees-message');

    tableBody.innerHTML = '';
    feeInputs = {};

    if (!currentFees.length) {
      noFeesMsg.classList.remove('hidden');
      return;
    }

    noFeesMsg.classList.add('hidden');

    currentFees.forEach((fee, index) => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td class="font-bengali">${index + 1}</td>
        <td class="font-bengali">${fee.item_name || '-'}</td>
        <td class="font-english text-right">${formatCurrency(fee.amount || 0)}</td>
        <td><input type="number" class="input-field" placeholder="0" value="0" data-fee-id="${index}" data-field="received" onchange="updateCalculations()" min="0"></td>
        <td><input type="number" class="input-field" placeholder="0" value="0" data-fee-id="${index}" data-field="discount" onchange="updateCalculations()" min="0"></td>
      `;
      tableBody.appendChild(row);

      feeInputs[index] = {
        amount: fee.amount || 0,
        received: row.querySelector(`input[data-field="received"]`),
        discount: row.querySelector(`input[data-field="discount"]`)
      };
    });

    updateCalculations();
  }

  // ==============================
  // Update Calculations
  // ==============================
  function updateCalculations() {
    let totalPayable = 0, totalReceived = 0, totalDiscount = 0;

    Object.values(feeInputs).forEach(fee => {
      totalPayable += fee.amount;
      totalReceived += parseInt(fee.received.value) || 0;
      totalDiscount += parseInt(fee.discount.value) || 0;
    });

    const netPayable = totalPayable - totalDiscount;

    document.getElementById('total-payable').textContent = formatCurrency(totalPayable);
    document.getElementById('total-received').textContent = formatCurrency(totalReceived);
    document.getElementById('total-discount').textContent = formatCurrency(totalDiscount);
    document.getElementById('net-payable').textContent = formatCurrency(netPayable);
  }

  // ==============================
  // Submit Fees
  // ==============================
  function submitFees() {
    let totalR = 0, totalD = 0;

    Object.values(feeInputs).forEach(fee => {
      totalR += parseInt(fee.received.value) || 0;
      totalD += parseInt(fee.discount.value) || 0;
    });

    if (totalR === 0 && totalD === 0) {
      showToast('‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶¨‡¶æ ‡¶õ‡¶æ‡¶°‡¶º ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®', 'warning');
      return;
    }

    window.tempReceived = totalR;
    window.tempDiscount = totalD;

    document.getElementById('confirm-total-received').textContent = formatCurrency(totalR);
    document.getElementById('confirm-total-discount').textContent = formatCurrency(totalD);
    document.getElementById('confirmation-modal').classList.add('active');
  }

  function closeConfirmationModal() {
    document.getElementById('confirmation-modal').classList.remove('active');
  }

  async function confirmSubmit() {
    const confirmBtn = document.getElementById('confirm-submit-btn');
    confirmBtn.disabled = true;
    confirmBtn.textContent = "‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®...";

    try {
      const paymentDetails = [];
      Object.keys(feeInputs).forEach(key => {
        const received = parseInt(feeInputs[key].received.value) || 0;
        const discount = parseInt(feeInputs[key].discount.value) || 0;
        if (received > 0 || discount > 0) {
          paymentDetails.push({
            item_name: currentFees[key].item_name,
            amount: received,
            discount: discount
          });
        }
      });

      const payload = {
        action: 'submitFeesDetailed',
        std_id: currentStudent.form_id,
        c_date: new Date().toISOString().split('T')[0],
        details: paymentDetails
      };
     
      await fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        cache: 'no-cache',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });

      showToast('‡¶´‡¶ø ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ú‡¶Æ‡¶æ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'success');
      setTimeout(() => {
        closeConfirmationModal();
        resetSearch();
      }, 1500);

    } catch (error) {
      console.error('Error:', error);
      showToast('‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá', 'error');
    } finally {
      confirmBtn.disabled = false;
      confirmBtn.textContent = "‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®";
    }
  }

  // ==============================
  // Reset Search
  // ==============================
  function resetSearch() {
    document.getElementById('search-id').value = '';
    document.getElementById('empty-state').classList.remove('hidden');
    document.getElementById('error-state').classList.add('hidden');
    document.getElementById('fees-container').classList.add('hidden');
    document.getElementById('loading-state').classList.add('hidden');
    document.getElementById('search-id').focus();
    currentStudent = null;
    currentFees = [];
  }

  window.addEventListener('load', () => document.getElementById('search-id').focus());

</script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9d3080de73777cd7',t:'MTc3MTk1MjI2MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
